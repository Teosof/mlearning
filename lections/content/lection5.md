# Лекция №5. График параллельных координат

Рассмотрим пять признаков в $m$-мерном пространстве. Каждый из них может состоять из скольки угодно элементов:
$$ x_1,x_2,x_3,x_4,x_5 $$ Алгоритм:

1. Нормируем каждый признак на интервале $[0;1]$.
2. Вычтем минимальное значение от каждого и поделим на размах выборки.
3. Минимум становится равным нулю, а максимум — разнице.
4. После деления на рамах для всех точек получим на прямой единицу — новое максимальное значение.

$$
x'_1=\frac{x_1-min(x_1)}{max(x_1)-min(x_1)}
$$

## Алгоритм построения графика после нормировки

1. По оси абсцисс — номер (имя) признака.
2. По оси ординат — нормированные значения в пределах от нуля до единицы.
3. Нанесем значения признаков первого объектов на график. Соединим полученные точки прямыми линиями.
4. Повторим эту операцию для каждого объекта.

## Реализация на APL

1. Соединим значения признаков для стандартного набора данных — ирисов в матрицу $ir$ и проверим размерность. В них 150
   объектов с четырьмя признаками.

   ```apl
   	  ⍴ir←ir1⍪ir2⍪ir3 
   150 4
   ```

2. Получаем график ломанных линий

   ```apl
      (150/1) parcoor ir
   ```

   ![График ломанных линий](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/1.png)

   Рассмотрим данный график. Если повернуть его на 90 градусов и представить каким образом будет выглядеть гистограмма, то получим, что она близка к равномерному распределению. От минимума до максимума, значения каждого из 150 объектов перемешаны, то есть отсутствует структура по первому признаку.

   Такая же ситуация для второго признака. Однако, если детальнее рассмотрим третий признак, то сможем выделить две отдельные группы. Часть объектов имеют малое значение этого признака, в то время как другая часть — большее значение. Такие суждения аналогичны и для четвертого признака. Построим для них графики.

   ```apl
      plot ir[;3 4]
   ```

   ![График двух признаков](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/2.png)

   Выделим две ярко выраженные группы, два кластера. Можем предположить, что первая группа принадлежит одному сорту, а
   вторая группа содержит в себе два смешанных сорта. Раскрасим график параллельных координат для более детального
   анализа:

   ![Цветной график ломанных линий](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/3.png)

   Значения первого и второго признаков сильно перемешаны. Рассмотрим третий и четвертый признаки. Первый сорт (черный цвет) сильно разнится с красным и синим сортами, следовательно, есть возможность поставить порог.
   
   Мы наблюдаем значения вперемешку: четыре красных попали к синим. Мы не можем безошибочно разделить эти классы, но можем выдвинуть предположение, что синие имеют меньшее значение признаков, чем красные. Построим раскрашенную плоскость для третьего и четвертого признака:
   
   ![Цветной график двух признаков](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/4.png)

Данный метод является крайне эффективным методом визуализации, так как позволяет игнорировать значения признаков.

## Radar plot

Аналогичный график мы можем получить в полярных координатах при помощи Excel.

![Radar plot](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/5.png)

Значения столбцов отличаются. В случае, если их много, то мы можем выявить несколько разных типов. Полученные графические результаты легки в обработке, потому что с ней может справиться даже ребенок. Формально, для него задача сведется к разделению картинок на два множества. Таким образом, будет произведен кластерный анализ. Данные графики позволяют выявить некие признаки и понизить размерность пространства, то есть из большого числа $X$ выбрать небольшое число.

## Примеры понижения размерности пространства

1. Расстояние до двух фиксированных точек.

   Центры классов чаще всего являются фиксированным точками. Допустим, что существуют два класса $\omega_1$ и
   $\omega_2$, следовательно, для них существуют и две фиксированные точки.

   ![Фиксированные точки](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/6.png)

   $\overrightarrow{m_1}$ - центр первого класса, а $\overrightarrow{m_2}$ - центр второго класса

   ![Фиксированные точки](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/7.png)

   По оси абсцисс расстояние до $R_1$, по оси ординат — до $R_2$. У $\omega_1$ расстояние до $M_1$ больше, чем до $M_2$. Для
   $\omega_2$ ситуация полностью противоположная.

   При изменениях делений по осям, вид самого графика изменяется незначительно. Данные графики необходимо строить для
   многомерного пространства.

   **Пример для двухмерного пространства**
   ```apl
      a←?9 2⍴0 ⍝ A-первый класс
      b←3+?7 2⍴0 ⍝ B-второй класс
      plot (⊂[1]a)(⊂[1]b)
   ```

   ![Двухмерное пространство](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/8.png)

   Вычислим $M_1$. Для этого напишем функцию $ave$, которая будет суммировать матрицу по первому измерению и делить на
   число строк:

    ```apl
      ave←{(+⌿⍵)÷≢⍵}
    ```

   Посчитаем значения для центров и отметим их на графике:
   ```apl
      m1←ave a
      m2←ave b
      color 'red'
      marker m1 ⍝ центр первого класса 
      marker m2 ⍝ центр второго класса
   ```

   ![Двухмерное пространство](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/9.png)

   Объединим $a$ и $b$ в одну матрицу. Обозначим $R_1$ как расстояние от $M_1$ до всех точек, а $R_2$ - от $M_2$.
   ```apl
      ab←a⍪b 
      r1←(+/(ab-[2]m1)*2)*0.5 
      r2←(+/(ab-[2]m2)*2)*0.5
      plot r1 r2
   ```

   ![Двухмерное пространство](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/10.png)

   Распределение перевернулось, но для нас ничего не изменилось. Раскрасим график:
   ```apl
      (9 7/1 2)plotc r1 r2
   ```

   ![Двухмерное пространство](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/11.png)

   Проецируем полученные результаты для стомерного пространства. Отобразим параллельные координаты для него — всего у
   нас будет 16 точек.

   ```apl
      a←?9 100⍴0 b←3+?7 100⍴0 ⍴a
      9 100 ⍴b
      7 100
      (16/1)parcoor a⍪b
   ```

   ![Стомерное пространство](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/12.png)

   Попробуем для этих результатов определить центры классов:

   ```apl
      m1←ave a m2←ave b ⍴m1
   100
      ⍴m2
   100
   ```

   Объединим $a$ и $b$ в одну матрицу. Посчитаем расстояние первого центра до всех точек и отобразим график:
   ```apl
      ab←a⍪b 
      r1←(+/(ab-[2]m1)*2)*0.5 
      r2←(+/(ab-[2]m2)*2)*0.5
      plot r1 r2
   ```

   ![Стомерное пространство](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/13.png)

   В результате получаем две группы на плоскости. Проверим первый признак на условие больше/меньше 15

   ```apl
      +/r1<15 
   9
      +/r1>15
   7
   ```

   Полученные результаты средствами APL можно обернуть в функцию.

   ```apl
      )ed m12proj   
   [0]    r←a m12proj b;ab;m1;m2;r1;r2 
   [1]    m1←{(+⌿⍵)÷≢⍵}a                     
   [2]    m2←{(+⌿⍵)÷≢⍵}b                
   [3]    ab←a⍪b                       
   [4]    r1←(+/(ab-[2]m1)*2)*0.5      
   [5]    r2←(+/(ab-[2]m2)*2)*0.5     
   [6]    r←r1 r2                      
   ```

   На выходе метода у нас будет вектор расстояний до первого класса и вектор расстояний для второго класса
   соответственно. Проверим работоспособность функции:
   ```apl
      plot a m12proj b
   ```

   ![Стомерное пространство](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/14.png)

2. Невозможность определить наличие двух классов

   ![Второй случай](/Users/roman/PycharmProjects/machine_learning/lections/images/lection5/15.png)

   Выделим особенные точки. Они отличаются от остальных, так как оин наиболее удалены друг от друга. Если посчитать все возможные расстояния между всеми точками и найти максимум, то он будет равен расстоянию между этими точками. Посчитаем расстояние: до $C_1$ - маленькие, до $C_2$ - большие.

   $$
   R_{xy}=\sqrt{\sum_{i=1}^{n}(x_i-y_i)^2} 
   $$

   При $n=2$ задача сводится к решению теоремы Пифагора.

   Посчитаем расстояние при помощи APL:

   ```apl
      ⍴ab 
   16 100
      dist←{(+/(⍺-⍵)*2)*.5}
   ```
   
   Предположим, что есть следующие точки:

   ```apl
      1 2
   1 2
      3 4
   3 4
   ```

   Расстояние между ними можем определить по графику: $\sqrt{8}=2.828427125$.
   При помощи функции, которую мы описали, выше мы можем посчитать расстояние между всеми a и b
   ```apl
      (1 2)(3 4) ∘.dist (2 1)(4 2) 
   1.414213562 3
   3.16227766  2.236067977
   ```
